<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Endocytosis | Membrane Dynamics</title>
    <style>
        :root { --brand-blue: #007AFF; --text-dark: #333; }
        body { margin: 0; padding: 0; font-family: -apple-system, sans-serif; background: #ffffff; color: var(--text-dark); overflow: hidden; touch-action: none; user-select: none; -webkit-user-select: none; }
        #app { display: flex; flex-direction: column; height: 100vh; padding: 20px; box-sizing: border-box; }
        header { text-align: center; margin-bottom: 10px; }
        h1 { font-weight: 300; font-size: 1.4rem; margin: 0; }
        canvas { flex-grow: 1; width: 100%; touch-action: none; border-radius: 8px; }
        .ui-panel { background: #f9f9f9; padding: 20px; border-radius: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        input[type=range] { width: 100%; cursor: pointer; accent-color: var(--brand-blue); height: 10px; }
        .labels { display: flex; justify-content: space-between; font-size: 0.75rem; color: #888; margin-top: 8px; text-transform: uppercase; letter-spacing: 1px; }
    </style>
</head>
<body oncontextmenu="return false;">

<div id="app">
    <header>
        <h1>Endocytosis</h1>
    </header>

    <canvas id="stage"></canvas>

    <div class="ui-panel">
        <input type="range" id="progress" min="0" max="1" step="0.001" value="0">
        <div class="labels">
            <span>Resting</span>
            <span>Invagination</span>
            <span>Vesicle</span>
        </div>
    </div>
</div>

<script>
/** * SECURITY & ANTI-REVERSE ENGINEERING 
 */
document.addEventListener('keydown', e => { if(e.ctrlKey && 'u s i j'.includes(e.key)) e.preventDefault(); });
setInterval(() => { if(window.outerHeight - window.innerHeight > 160) document.body.innerHTML = ""; }, 500);

/** * MEMBRANE PHYSICS 
 */
const canvas = document.getElementById('stage');
const ctx = canvas.getContext('2d');
const slider = document.getElementById('progress');

let width, height, time = 0;
const LIPID_SPACING = 14; // Constant distance between heads

function resize() {
    width = canvas.width = canvas.clientWidth * window.devicePixelRatio;
    height = canvas.height = canvas.clientHeight * window.devicePixelRatio;
}
window.addEventListener('resize', resize);
resize();

function getMembranePoint(t, progress) {
    // t ranges from -1 to 1 (left to right)
    let x = t * (width * 0.6) + (width / 2);
    let y = height * 0.35;
    
    // Smooth wave movement
    const wave = Math.sin(time + t * 10) * 3;
    
    // Endocytosis Math: Transition from line to Omega shape to Circle
    const influence = Math.exp(-Math.pow(t * 4, 2)); // Bell curve for local deformation
    
    if (progress < 0.7) {
        // Invagination phase
        y += (progress * 200) * influence;
    } else {
        // Vesicle formation & Pinching phase
        const pinchProg = (progress - 0.7) / 0.3;
        const centerX = width / 2;
        const centerY = height * 0.35 + 140;
        const radius = 50;
        
        // Morph the local curve into a circle
        if (Math.abs(t) < 0.25) {
            const angle = (t / 0.25) * Math.PI + Math.PI;
            const targetX = centerX + Math.sin(angle) * radius;
            const targetY = centerY + Math.cos(angle) * radius;
            
            x = x * (1 - pinchProg) + targetX * pinchProg;
            y = y * (1 - pinchProg) + targetY * pinchProg;
        }
        
        // Heal the top membrane gap
        if (Math.abs(t) >= 0.25) {
            const gapFill = Math.sign(t) * (0.25 * (width * 0.6)) * pinchProg;
            x -= gapFill;
        }
    }
    
    return { x, y: y + wave, angle: t };
}

function drawLipid(x, y, angle, isBottom) {
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(angle);
    if (isBottom) ctx.rotate(Math.PI);

    // Head
    ctx.beginPath();
    ctx.arc(0, 0, 4.5, 0, Math.PI * 2);
    ctx.fillStyle = '#333';
    ctx.fill();

    // Tails (Fluid wiggle)
    const wiggle = Math.sin(time * 2) * 2;
    ctx.beginPath();
    ctx.moveTo(-2, 4); ctx.quadraticCurveTo(-3 + wiggle, 10, -2, 14);
    ctx.moveTo(2, 4); ctx.quadraticCurveTo(3 + wiggle, 10, 2, 14);
    ctx.strokeStyle = '#999';
    ctx.lineWidth = 1.2;
    ctx.stroke();
    ctx.restore();
}

function render() {
    ctx.clearRect(0, 0, width, height);
    time += 0.04;
    const p = parseFloat(slider.value);

    // Target Molecule
    const molY = height * 0.35 + (p * 140);
    ctx.beginPath();
    ctx.arc(width/2, molY, 12, 0, Math.PI*2);
    ctx.fillStyle = "#FF3B30";
    ctx.fill();

    // Generate Points at constant spatial intervals
    // We iterate with a high resolution and only draw when we've moved LIPID_SPACING distance
    let lastX, lastY;
    let accumulatedDist = 0;

    for (let t = -1; t <= 1; t += 0.005) {
        const pt = getMembranePoint(t, p);
        
        if (lastX !== undefined) {
            const d = Math.sqrt((pt.x - lastX)**2 + (pt.y - lastY)**2);
            accumulatedDist += d;
            
            if (accumulatedDist >= LIPID_SPACING) {
                // Calculate tangent for rotation
                const angle = Math.atan2(pt.y - lastY, pt.x - lastX) + Math.PI/2;
                
                // Draw Outer Leaflet
                drawLipid(pt.x, pt.y, angle, false);
                // Draw Inner Leaflet (offset by width)
                const offset = 22;
                drawLipid(pt.x + Math.cos(angle + Math.PI/2) * offset, 
                          pt.y + Math.sin(angle + Math.PI/2) * offset, angle, true);
                
                accumulatedDist = 0;
            }
        }
        lastX = pt.x;
        lastY = pt.y;
    }

    requestAnimationFrame(render);
}

render();
</script>
</body>
</html>
